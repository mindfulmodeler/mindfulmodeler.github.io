---
layout: page
sidebar: left
subheadline: python snippet
title:  "code scrap"
teaser: "snip 2"
breadcrumb: true
tags:
    - python
    - ema workbench
categories:
    - snips
header:
    image_fullwidth: "/rotav_OE_title.webp"
    # caption: Open exploration in EMA workbench
    # caption_url: https://unsplash.com/
image:
    title: /rotav_OE_title.webp
show_meta: true
---

As the availability of computational power grows, the potential of exploratory modeling continues to expand. Advancements have been made in fields such as: [water resources](https://doi.org/10.1111/j.1539-6924.2007.00940.x), [policy analysis](https://doi.org/10.1016/j.envsoft.2017.06.054), [ecosystem management](https://www.jstor.org/stable/26270230), and [operations research](https://doi.org/10.1287/opre.41.3.435). Open-source languages like python have supported powerful simulations in becoming more accessible than ever before. One of the most challenging frontiers, however, has been the ability of an analyst to visualize the results of an exploratory model. Visualization is difficult because the results of exploratory modeling are often in the form of high-dimensional information ensembles, making many traditional plotting methods ill-equipped to handle the data. The following article contains some python visualization examples for high-dimensional exploratory modeling output.

<div class="panel radius" markdown="1">
**Table of Contents**
{: #toc }
*  TOC
{:toc}
</div>

# Exploratory Modeling Workbench
This post is intended for readers with an intermediate to advanced knowledge of the [EMA workbench](https://github.com/quaquel/EMAworkbench), created by Jan Kwakkel from TU Delft. The EMA workbench documentation and GitHub tutorials contain many examples of how to implement the module. For this article, emphasis is placed on multidimensional visualization techniques for open exploration of the objective space.

In this example, I am using a model that simulates the burden of disease caused by four different infectious pathogens in a community. Here, users are interested in finding combinations of public health policy levers (e.g. providing clean water, sanitation, vaccination, medical treatment) that reduce the burden of disease. The model was created in Vensim (although you can substitute your own model made in python, Netlogo, etc). Readers interested in this multi-disease model can find more details [here](https://github.com/shannongross/multi_disease_model).

The first step to performing open exploration on the model is to import it (in this case, using a `.py` file), along with some standard packages. In this case, I use the function `get_model_for_problem_formulation` to retrieve the Vensim model.


{% highlight ruby %}
# PARALLEL COORDINATE PLOT EXAMPLE

# Begin by rescaling objectives. Get the maximum and minimum value of each result.
limits = parcoords.get_limits(df_outcomes)
# Set the lower limit of all objectives to zero.
lower_lim = limits.loc[0, list(df_outcomes)]
# Set the upper limit of all objectives to one.
upper_lim = limits.loc[1, list(df_outcomes)]

# Normalize the limits to make tradeoff plots easier to read (same scale)
lower_lim_for_sub = lower_lim
lower_lim_for_sub[2] = 0
upper_lim_for_sub = upper_lim
upper_lim_for_sub[2] = 1
normalized_limits = df_outcomes - lower_lim_for_sub
normalized_limits = normalized_limits/upper_lim_for_sub

# If you want to differentiate by policy, map the experiment set to the objective space.
df_normalized_limits = normalized_limits.assign(policy=experiments['policy'])
df_normalized_limits['policy'] = df_normalized_limits['policy'].map({p:i for i, p in enumerate(set(experiments['policy']))})  
newlimits = parcoords.get_limits(df_normalized_limits)

# Create parallel axis plot
paraxes = parcoords.ParallelAxes(newlimits, fontsize=14,rot=90)
for i,p in enumerate(set(experiments['policy'])):
   paraxes.plot(df_normalized_limits[df_normalized_limits['policy']==i],
                  label=p, color=sns.color_palette("bright", 8)[i],alpha= 0.45)#colors[i])
fig = plt.gcf()
fig.set_size_inches(10,7)
paraxes.legend()
plt.title('Problem Formulation 1: {}'.format(disease_model.name), fontsize=16, y=1.08, loc='right')
plt.show()
{% endhighlight %}

Each line represents a possible policy option, with lines closest to the bottom of the y-axis being performing more favorably in terms of the decision makerâ€™s objectives. The result of the previous code resembles the following:

![parallel axis plot]({{site.baseurl}}/images/rotav_OE_paraplot.png)


## Visualizing Open Exploration - Conclusion
{: .no_toc}
Exploratory modeling and analysis is a powerful tool that is growing in popularity for many complex policy problems. Open Exploration is a crucial first step towards achieving the goal of "understanding the factors that make the biggest difference" on policy objectives. Especially in situations where information is deeply uncertain or there are severe data gaps, traditional methods of quantitative modeling that focus on probability or risk are impracticable. Exploratory models are more appropriate for helping decision makers learn about the system and different strategic options, rather than models that use big assumptions to prescribe a single solution.

 In an upcoming blog post, I'll dive deeper into the pros and cons of different visualization methods. I'll also discuss the use of multiple problem formulations. You can view the full Jupyter notebook containing this code <a href="https://github.com/shannongross/code_support/blob/master/OE_Visualization_Example.ipynb" target="_blank">here</a>.


